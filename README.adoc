image::snap/gui/CMake_Logo_wide.svg[CMake]

This is the snap for CMake, a cross-platform, open-source build system generator.

image::https://snapcraft.io/cmake/badge.svg[link="https://snapcraft.io/cmake"]

# Release Instructions

Each CMake feature release has its own corresponding branch in this repository.
These branches follow the naming convention `release/X.Y`.
The master branch of this repository should only be used for producing packages for the master branch of CMake.

When an official CMake release is made (including release candidates), create or checkout the branch tracking that feature release.
Update the `cmakeVersion` at the top of the link:doRelease.sh[doRelease.sh] script and commit that change.
Run that script locally on a Linux machine.

The script will run two `snapcraft remote-build` jobs.
The first builds the majority of the snaps using the `core20` base.
The second builds the `i386` architecture, which has to use the `core18` base.
Once both builds have been completed, the log files will be collected into a tarball `build/cmake_<version>_logs.tar.gz` for easy archiving.
All the snaps will be available in the `build` directory as well for local testing if required.

Once all `remote-build` jobs have been completed, the snaps will be uploaded to the `edge` channel of the relevant track.
The uploads are done in parallel, since they can take a while.
Once all uploads have been completed, the script will finish.

# GitHub Integration

There are problems with the GitHub integration which prevent it from being suitable for release builds at this time:

* It always builds the default branch, regardless of which branch is pushed to trigger a build.
  See https://forum.snapcraft.io/t/snap-build-service-picking-default-branch-instead-of-pushed-branch>[this forum post] describing the problem.
* We need to specify a specific source tag for the CMake repo in release builds, which requires modifying the link:snap/snapcraft.yaml[snapcraft.yaml] file.
* We have to modify the base used due to the `i386` architecture not being supported as of `core20`, which also requires modifying the link:snap/snapcraft.yaml[snapcraft.yaml] file.

We also cannot use GitHub actions directly because it doesn't support building for all the architectures we need.
